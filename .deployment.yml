deployment:
  tasks:
    - echo "🚀 Starting Deployment for Branch: $(git rev-parse --abbrev-ref HEAD)"
    - export COMPOSER_ALLOW_SUPERUSER=1

    # Determine environment based on branch
    - |
      BRANCH=$(git rev-parse --abbrev-ref HEAD)
      echo "Detected branch: $BRANCH"
      if [ "$BRANCH" = "main" ]; then
        echo "🌍 Environment: PRODUCTION"
        composer install --no-dev --optimize-autoloader
        php artisan migrate --force
        php artisan optimize:clear
        php artisan config:cache
        php artisan route:cache
        php artisan view:cache
      else
        echo "🧪 Environment: STAGING"
        composer install
        php artisan migrate
        php artisan optimize:clear
        php artisan config:clear
      fi

    - echo "✅ Deployment Completed Successfully!"
